<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="bootstrap-cosmo.min.css?v0.1">
    <link rel="stylesheet" href="main.css">
</head>

<body>




    <div id="app" class="container-fluid">
        <h1 class="text-center">OS Project</h1>
        <div class="container">
            <div class="row">
                <div class="col-xs-8 col-xs-offset-2">
                    <select id="method" class="form-control"></select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <form class="form-group" onsubmit="event.preventDefault(); addItem(); draw();">
                    <div class="row">
                        <div class="col-xs-2">
                            <input type="text" id="item-id" class="form-control" placeholder="ID" />
                        </div>
                        <div class="col-xs-2">
                            <input type="text" id="item-name" class="form-control" placeholder="Task Name" />
                        </div>
                        <div class="col-xs-2">
                            <input type="text" id="item-arrival" class="form-control" placeholder="Arrival" />
                        </div>
                        <div class="col-xs-2">
                            <input type="text" id="item-burst" class="form-control" placeholder="Burst" />
                        </div>
                        <div class="col-xs-2">
                            <input type="text" id="item-par" class="form-control" placeholder="Pariority" />
                        </div>
                        <div class="col-xs-2">
                            <input type="text" id="item-quantum" class="form-control" placeholder="Quantum" />
                        </div>
                    </div>
                    <button class="btn btn-success btn-block" type="submit">Add Item</button>
                </form>
                <button class="btn btn-danger" onclick="clearMemory()">Clear</button>

                <table class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Arrival</th>
                            <th>Burst</th>
                            <th>Pariority</th>
                            <th>Quantum</th>
                        </tr>
                    </thead>
                    <tbody id="items">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Print Gantt Chart -->
        <div class="responsive">
            <tbody>
            <table class="table table-hover table-bordered">
                    <tr id="gantt"></tr>
                </tbody>
            </table>
            <table class="table table-hover" id="gantt__table">
                <tbody>
                    <tr id="gantt__scale"></tr>
                </tbody>
            </table>
        </div>
    </div>


    <script>

        var items = []; // Memory of the Application
        var counter = 0; // Counter
        var turnAroundTimeArray = [];
        var avgTimeArray = [];
        var turnAroundTime = 0;
        var avgWaitingTime = 0;
        initSelectMethod();

        // Get Select Box
        var select = document.getElementById('method');
        select.addEventListener('change', function (e) {
            draw();
        });

        draw();

        function clearTables() {
            let list = document.getElementById('items');
            let ganttChart = document.getElementById('gantt');
            let ganttScale = document.getElementById('gantt__scale');
            var inputId = document.getElementById("item-id");
            var inputName = document.getElementById("item-name");
            var inputArrival = document.getElementById("item-arrival");
            var inputBurst = document.getElementById("item-burst");
            var inputPariority = document.getElementById("item-par");
            var inputQuantum = document.getElementById("item-quantum");
            inputId.value = '';
            inputName.value = '';
            inputArrival.value = '';
            inputBurst.value = '';
            inputPariority.value = '';
            inputQuantum.value = '';
            list.innerHTML = '';
            ganttChart.innerHTML = '';
            ganttScale.innerHTML = '';
        }
        function clearMemory() {
            items = [];
            clearTables();
            counter = 0;
        }


        function initSelectMethod() {
            var select = document.getElementById('method');
            var methods = [
                { value: "FCFS", name: "FCFS" },
                { value: "SJFNP", name: "SJF Non-Preemptive" },
                { value: "SJFP", name: "SJF Preemptive" },
                { value: "PNP", name: "Priority Non-Preemptive" },
                { value: "PP", name: "Priority Preemptive" },
                { value: "RR", name: "Round Robin" },
            ];
            let methodOption = '';
            for (let method of methods) {
                methodOption += `<option value='${method['value']}'>${method['name']}</options>`;
            }
            select.innerHTML += methodOption;
            select.value = methods[0].value;
        }


        function draw() {
            let quant = document.getElementById('item-quantum').value;
            if (select.value === 'FCFS') {
                items.sort(sortArrayBy('arrival'));
                printItems();
                printGanttChart();
            } else if (select.value === 'SJFP') {

            } else if (select.value === 'SJFNP') {
                // TODO: More Test Cases
                items.sort(sortArrayBy('burst'));
                printItems();
                printGanttChart();
            } else if (select.value === 'RR') {
                // Robin Round Algorithm
                drawRobinRound(Number(quant));

            } else if (select.value === 'PNP') {
                items.sort(sortArrayBy('pariority'));
                printItems();
                printGanttChart();
            } else if (select.value === 'PP') {

            }


        }


        function sortArrayBy(prop) {
            return function (a, b) {
                return Number(a[prop]) > Number(b[prop]);
            }
        }

        function sortRR(a, b) {
            // Round Robin Algorithm 

        }
        function SJF(a, b) {

        }

        function drawRobinRound(quantum) {
            var gantt = document.getElementById('gantt');
            var gantt_scale = document.getElementById('gantt__scale');
            gantt.innerHTML = '';
            gantt_scale.innerHTML = '';
            let step = '';
            let stepNumbers = '';
            let allBurstTime = 0;
            let robinRoundArray = JSON.parse(JSON.stringify(items)); // Deep Copying Of Array Of Objects
            let done = true;
            let tracker = false;
            while (1) {
                done = true;
                for (let i = 0; i < robinRoundArray.length; i++) {
                    if (robinRoundArray[i]['burst'] > 0) {
                        done = false;
                        if (robinRoundArray[i]['burst'] > quantum) {
                            robinRoundArray[i]['burst'] = Number(robinRoundArray[i]['burst']) - quantum;
                            allBurstTime += quantum;
                            let widthNumber = quantum * 5;
                            step += `<td style="width:${widthNumber}px" class="text-center">${robinRoundArray[i]['name']}</td>`;
                            if (i === 0 && tracker === false) { // First Cell
                                tracker = true;
                                stepNumbers += `<td style="width:${widthNumber}px">
                                    <span class="pull-left">0</span>
                                    <span class="pull-right">${allBurstTime}</span>
                                    </td>
                                    `;
                            } else { // Other Cells
                                stepNumbers += `<td style="width:${widthNumber}px">
                                        <span class="pull-right">${allBurstTime}</span>
                                        </td>
                                        `;
                            }
                        } else {
                            allBurstTime += Number(robinRoundArray[i]['burst']);
                            let widthNumber = Number(robinRoundArray[i]['burst']) * 5;
                            robinRoundArray[i]['burst'] = 0;
                            step += `<td style="width:${widthNumber}px" class="text-center">${robinRoundArray[i]['name']}</td>`;
                            if (i === 0 && tracker === false) { // First Cell
                                tracker = true;
                                stepNumbers += `<td style="width:${widthNumber}px">
                                    <span class="pull-left">0</span>
                                    <span class="pull-right">${Number(robinRoundArray[i]['burst'])}</span>
                                    </td>
                                    `;
                            } else { // Other Cells
                                stepNumbers += `<td style="width:${widthNumber}px">
                                            <span class="pull-right">${allBurstTime}</span>
                                            </td>
                                            `;
                            }
                        }
                    }
                }
                if (done === true) {
                    break;
                }

            }
            gantt.innerHTML = step;
            gantt_scale.innerHTML = stepNumbers;
        }

        function printNewItem() {
            var list = document.getElementById("items");
            for (let i = counter - 1; i < items.length; i++) {
                let singleList = '<tr>';
                let itemData = items[i];
                for (key in itemData) {
                    singleList += `<td>${itemData[key]}</td>`
                }
                singleList += '</tr>';
                list.innerHTML += singleList;
            }
        }

        function printItems() {
            var list = document.getElementById("items");
            list.innerHTML = '';
            for (let i = 0; i < items.length; i++) {
                let singleList = '<tr>';
                let itemData = items[i];
                for (key in itemData) {
                    singleList += `<td>${itemData[key]}</td>`
                }
                singleList += '</tr>';
                list.innerHTML += singleList;
            }
        }


        // Gantt Chart Draw Function
        function printGanttChart() {
            var gantt = document.getElementById('gantt');
            var gantt_scale = document.getElementById('gantt__scale');
            let step = '';
            let stepNumbers = '';
            let allBurstTime = 0;
            items.forEach((item, i) => {
                allBurstTime += Number(item['burst']);
                let widthNumber = Number(item['burst']) * 5;
                step += `<td style="width:${widthNumber}px" class="text-center">${item['name']}</td>`;
                if (i === 0) { // First Cell
                    stepNumbers += `<td style="width:${widthNumber}px">
                    <span class="pull-left">0</span>
                    <span class="pull-right">${Number(item['burst'])}</span>
                    </td>
                    `;
                } else { // Other Cells
                    stepNumbers += `<td style="width:${widthNumber}px">
                    <span class="pull-right">${allBurstTime}</span>
                    </td>
                    `;
                }
            });
            gantt.innerHTML = step;
            gantt_scale.innerHTML = stepNumbers;



        }

        /*
            [ Function Name ] : addItems()
            [ Functionality ] : Add Items By the Inputs From User
            [ Used Fucntions ] : JavaScript DOM Elemenets ==> Catch By ID  
        */
        function addItem() {
            var inputId = document.getElementById("item-id");
            var inputName = document.getElementById("item-name");
            var inputArrival = document.getElementById("item-arrival");
            var inputBurst = document.getElementById("item-burst");
            var inputPariority = document.getElementById("item-par");
            var inputQuantum = document.getElementById("item-quantum");
            var itemData = {
                id: inputId.value,
                name: inputName.value,
                arrival: inputArrival.value,
                burst: inputBurst.value,
                pariority: inputPariority.value,
                quantum: inputQuantum.value
            };

            counter++;
            items.push(itemData);
            printNewItem();
        }

    </script>

</body>

</html>